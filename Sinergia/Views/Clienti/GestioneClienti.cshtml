@{
    ViewBag.Title = "Gestione Clienti Esterni";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section styles {
    <style>
        span[role="status"] {
            display: none !important;
        }

        .table > tbody > tr > td {
            padding: 8px;
            vertical-align: middle;
        }

        .mylabel {
            margin-bottom: 4px;
            color: #999;
            font-size: 12px;
            font-weight: 500;
        }

        .table-responsive {
            overflow-x: auto;
        }
    </style>
}

@section pagespecific {

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

    <!-- jQuery UI -->
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

    <!-- Datepicker IT -->
    <script src="~/Scripts/datepicker-it.js"></script>

    <!-- DataTables CORE -->
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>

    <!-- DataTables Buttons + Excel / PDF -->
    <script src="https://cdn.datatables.net/buttons/1.6.5/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.html5.min.js"></script>
}

<div id="content">
    <div class="row">
        <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
            <h1 class="page-title txt-color-blueDark">
                <i class="fa fa-user-friends fa-fw"></i> Gestione Clienti Esterni
            </h1>
        </div>
    </div>

    <section id="widget-grid">
        <div class="row">
            <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="jarviswidget"
                     id="wid-id-clienti"
                     data-widget-editbutton="false"
                     data-widget-deletebutton="false">

                    <header>
                        <h2 class="fadeInLeft animated">Lista Clienti</h2>
                    </header>

                    <div>
                        <div class="widget-body no-padding">
                            <div id="clientiContainer" class="table-responsive">
                                @Html.Action("GestioneClientiList")
                            </div>
                        </div>
                    </div>

                </div>
            </article>
        </div>
    </section>
</div>

@section scripts {

    <script>
        // ============================
        // INIT DATATABLE CLIENTI
        // ============================
        function initClientiTable() {

            // se la tabella non esiste, esci
            if ($('#clientiTable').length === 0)
                return;

            // ✅ controllo corretto
            if ($.fn.dataTable.isDataTable('#clientiTable')) {
                $('#clientiTable').DataTable().destroy();
            }

            $('#clientiTable').DataTable({
                dom: 'Bfrtip',
                stateSave: true,
                columnDefs: [
                    { orderable: false, targets: -1 } // Azioni NON ordinabili
                ],
                buttons: [
                    {
                        extend: 'excelHtml5',
                        text: 'Excel',
                        exportOptions: { columns: ':not(:last-child)' }
                    },
                    {
                        extend: 'pdfHtml5',
                        text: 'PDF',
                        orientation: 'landscape',
                        pageSize: 'A4',
                        exportOptions: { columns: ':not(:last-child)' }
                    }
                ]
            });
        }

        // ⚠️ Html.Action è SINCRONO → ready va bene
        $(document).ready(function () {
            initClientiTable();
        });

    </script>

}

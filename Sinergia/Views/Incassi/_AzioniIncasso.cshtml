@model Sinergia.Models.IncassoViewModel

@{
    bool puoModificare = ViewData["PuoModificare"] as bool? ?? false;
    bool puoEliminare = ViewData["PuoEliminare"] as bool? ?? false;
    string tipoUtente = ViewData["TipoUtente"] as string ?? "";

    bool haIncasso = Model.ID_Incasso > 0;
    bool haAvviso = !string.IsNullOrEmpty(Model.NomePratica);
    string statoAvviso = Model.StatoAvviso ?? "";
}

<div class="d-flex flex-wrap gap-1 justify-content-center">

    @* 💰 CREA INCASSO (solo se esiste un avviso da pagare e nessun incasso registrato) *@
    @if (!haIncasso && haAvviso && statoAvviso != "Pagato" && puoModificare)
    {
        <button class="btn btn-success btn-sm rounded-circle"
                title="Crea incasso da avviso parcella"
                onclick="apriNuovoIncasso(@Model.ID_AvvisoParcella)">
            <i class="fa-solid fa-money-bill-wave"></i>
        </button>
    }

    @* 👁️ VISUALIZZA DETTAGLIO INCASSO (solo se già pagato) *@
    @if (haIncasso && statoAvviso == "Pagato")
    {
        <button class="btn btn-outline-primary btn-sm rounded-circle"
                title="Visualizza dettaglio incasso"
                onclick="apriDettaglioIncasso(@Model.ID_Incasso)">
            <i class="fa-regular fa-eye"></i>
        </button>
    }

    @* 🗑️ ELIMINA — SEMPRE ATTIVO se l’utente ha permesso *@
    @if (puoEliminare)
    {
        <button class="btn btn-outline-danger btn-sm rounded-circle"
                title="Elimina incasso (ripristina l’avviso come da pagare)"
                onclick="confermaEliminazioneIncasso(@Model.ID_Incasso)">
            <i class="fa-regular fa-trash-can"></i>
        </button>
    }

    @* 📁 APRI PRATICA *@
    <a class="btn btn-outline-info btn-sm rounded-circle"
       title="Apri la pratica collegata"
       href="@Url.Action("DettaglioPratica", "Pratiche", new { id = Model.ID_Pratiche })">
        <i class="fa-regular fa-file"></i>
    </a>

    @* 📊 SOLO ADMIN — riepilogo Sinergia *@
    @if (tipoUtente == "Admin" && Model.ID_AvvisoParcella > 0)
    {
        <button class="btn btn-outline-secondary btn-sm rounded-circle"
                title="Riepilogo trattenute e Sinergia"
                onclick="apriRiepilogoRicaviSinergia(@Model.ID_AvvisoParcella)">
            <i class="fa-solid fa-chart-line"></i>
        </button>
    }

</div>
